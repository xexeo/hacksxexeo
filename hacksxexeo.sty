\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{hacksxexeo}[2021/04/20 - Para trabalhar com o orientador Geraldo Xexéo]

\newif\if@showcomentario\@showcomentariofalse
\DeclareOption{comentarios}{
    \@showcomentariotrue}

\newif\if@showcomentario\@showcomentariofalse
\DeclareOption{comentarios}{
    \@showcomentariotrue}

\newif\if@showassuntos\@showassuntosfalse
\DeclareOption{assuntos}{\@showassuntostrue}

\newif\if@beanonymous\@beanonymousfalse
\DeclareOption{anonimizar}{\@beanonymoustrue}

\ProcessOptions\relax
 
 
    
% Genérico
%\RequirePackage{color}
\RequirePackage{xcolor}
\RequirePackage{soulutf8 }
%para os comentários e a lista
\if@showcomentario
\RequirePackage[show]{ed}
\else
\RequirePackage{ed}
\fi
\RequirePackage{tocloft}
\RequirePackage{xparse}
%\RequirePackage[fit]{truncate}

% as opções comentario, assuntos e anonimizar

% CORES
\newcommand{\cor@prof}{red}
\newcommand{\cor@cand}{blue}
\newcommand{\cor@assunto}{green}
\newcommand{\cor@citar}{purple}
% Suaviação nas cores para o hilight
\newcommand{\cor@suavizacao}{40}




% Anonimização
%\def\xanonimizar{} %% set to true
%% or:

% Se anonimiza, escreve anonymous
% se não escreve o texto
\if@beanonymous
\newcommand{\xanon}[1]{Anonymous}
\newcommand{\xanoncitep}[1]{(Anonymous,Year)}
\newcommand{\xanoncitet}[1]{Anonymous (Year)}
\else
\newcommand{\xanon}[1]{#1}
\newcommand{\xanoncitep}[1]{\citep{#1}}
\newcommand{\xanoncitet}[1]{\citet{#1}}
\fi

%
% Assuntos colore o texto apenas, pode melhorar



% Cria a lista
\if@showassuntos
% cria o título
\newcommand{\listassunto}{Lista de Assuntos}
% cria a lista
\@ifundefined{chapter}{\newlistof[section]{assunto}{aaa}{\listassunto}}{\newlistof[chapter]{assunto}{aaa}{\listassunto}}
\else
% se não é para mostrar, não faz nada
\newcommand{\listofassunto}{}
\fi

% Esse comando é para isolar o pacote ed
% Que não atende todas as minhas expectativas
\if@showassuntos
\newcommand{\xassunto}[2][\cor@assunto]{
\refstepcounter{assunto}
\sethlcolor{#1}%
\hl{#2}
\par
\addcontentsline{aaa}{assunto}{\protect\numberline{\theassunto}{#2}}%
}
\else
\newcommand{\xassunto}[1]{}
\fi




% Agora vamos arrumar os comentários

%Isso é um truque para o \hl do soulutf8 funcionar
%https://tex.stackexchange.com/questions/410295/soul-color-transparency
\if@showcomentario
\newcommand{\corleve}[1]{#1!\cor@suavizacao!white}
\newcommand{\x@hl}[2]{\colorlet{x@coraqui}{\corleve{#1}}\IfValueTF{#1}{\sethlcolor{x@coraqui}\hl{#2}}{}}
\fi



% Cria a lista
\if@showcomentario
% cria o título
\newcommand{\listcomentario}{Lista de Comentários}
% cria a lista
\@ifundefined{chapter}{\newlistof[section]{comentario}{ccc}{\listcomentario}}{\newlistof[chapter]{comentario}{ccc}{\listcomentario}}
\else
% se não é para mostrar, não faz nada
\newcommand{\listofcomentario}{}
\fi

% Esse comando é para isolar o pacote ed
% Que não atende todas as minhas expectativas
% Ele tem algumas variações
\if@showcomentario
\newcommand{\xcomment}[3][]{%
\refstepcounter{comentario}% soma um ao contador
\x@hl{#2}{#1}% ver subfunção de impressão com hl
\ednote{\textcolor{#2}{#3}}% faz a nota de rodapé do ed 
\addcontentsline{ccc}{comentario}{\protect\numberline{\thecomentario}{#3}}%
}%
\else%
\newcommand{\xcomment}[3]{}%
\fi

\if@showcomentario
\newcommand{\xcommentLabeled}[4][]{%
\refstepcounter{comentario}%
\x@hl{#2}{#1}%
\ednote[#4]{\textcolor{#2}{#3}}%
\addcontentsline{ccc}{comentario}{\protect\numberline{\thecomentario}{[#4] - #3}}%
}%
\else%
\newcommand{\xcommentLabeled}[4]{}%
\fi





%\newcommand{\edx}[2]{\xcomment{\textcolor{#1}{#2}}}
\newcommand{\prof}[2][]{\xcomment[#1]{red}{#2}}
\newcommand{\cand}[2][]{\xcomment[#1]{\cor@cand}{#2}}
\newcommand{\profr}[3][]{\xcommentLabeled[#1]{\cor@prof}{#2}{#3}}
\newcommand{\candr}[3][]{\xcommentLabeled[#1]{\cor@cand}{#2}{#3}}

\newcommand{\profsug}[1]{\textcolor{\cor@prof}{#1}}
\newcommand{\candsug}[1]{\textcolor{\cor@cand}{#1}}

% reclamações sobre citações

\if@showcomentario
% cria o título
\newcommand{\listcomentarioref}{Necessidades de Citação}
% cria a lista
\@ifundefined{chapter}{ \newlistof[section]{comentarioref}{ccr}{\listcomentarioref}}{\newlistof[chapter]{comentarioref}{ccr}{\listcomentarioref}}
\else
% se não é para mostrar, não faz nada
\newcommand{\listofcomentarioref}{}
\fi


\if@showcomentario
\newcommand{\xcommentref}[3][]{
\refstepcounter{comentarioref}
\IfValueTF{#1}{\sethlcolor{#2}\hl{#1}}{}
\ednote{\textcolor{#2}{#3}}
\addcontentsline{ccr}{comentarioref}{\protect\numberline{\thecomentarioref}{#3}}%
}
\else
\newcommand{\xcomment}[3]{}
\fi



\newcommand{\favorcitar}[1][algo que suporte essa afirmação]{\xcommentref{\cor@citar}{Citação: Por favor citar #1}}


\newcommand{\namargem}{\ed@margin{Teste}}